<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ro">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Coș | Fillermed</title>
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <style>
        .cart-page { padding: 1.25rem 0 2rem; }
        .cart-shell{
          display:grid;
          grid-template-columns: 1fr 0.35fr;
          gap: 1rem;
          align-items:start;
        }
        .cart-box{
          background: var(--card-bg);
          border: 1px solid #e5e7eb;
          box-shadow: 0 6px 18px rgba(15,23,42,.08);
          padding: 1rem;
        }
        .cart-row{
          display:grid;
          grid-template-columns: 84px 1fr auto;
          gap: .8rem;
          padding: .75rem 0;
          border-bottom: 1px solid #e5e7eb;
          align-items:center;
        }
        .cart-row:last-child{ border-bottom:0; }
        .cart-img{ width:84px; height:104px; object-fit:cover; background:#f9fafb; }
        .cart-title{ font-weight:900; margin:0 0 .25rem; }
        .cart-meta{ color: var(--muted); font-size:.9rem; }
        .qty{
          display:flex; gap:.4rem; align-items:center; justify-content:flex-end; flex-wrap:wrap;
        }
        .qty input{
          width: 86px;
          padding:.55rem .7rem;
          border:1px solid #d1d5db;
        }
        .btn-small{
          padding:.55rem .75rem;
          border:1px solid #e5e7eb;
          background:#fff;
          font-weight:800;
          cursor:pointer;
        }
        .btn-small:hover{ background:#fdf2fb; }
        .sum{
          display:flex; justify-content:space-between; margin:.5rem 0;
          font-weight:800;
        }
        .btn-primary-cart{
          width:100%;
          padding:.8rem 1rem;
          border:none;
          background: var(--primary);
          color:#fff;
          font-weight:900;
          cursor:pointer;
          box-shadow: 0 12px 30px rgba(234,90,202,.25);
          text-align:center;
          display:block;
        }
        @media (max-width: 900px){
          .cart-shell{ grid-template-columns: 1fr; }
          .qty{ justify-content:flex-start; }
          .cart-row{ grid-template-columns: 84px 1fr; }
          .cart-row > .qty{ grid-column: 1 / -1; justify-content:flex-start; }
        }
        @media (max-width: 640px) {
  .logo-img {
    opacity: 1;
    transform: translateY(0);
    transition: opacity 0.5s ease, transform 0.5s ease;
  }

  /* ascundem doar când splash-ul e activ */
  body.has-splash .logo-img {
    opacity: 0;
    transform: translateY(-10px);
  }
}
    </style>
</head>
<body>

<div th:replace="~{public/fragments/layout :: siteHeader(${cart})}"></div>
<main class="cart-page">
    <div class="container">

        <div style="font-size:.85rem; color: var(--muted); margin: .25rem 0 1rem;">
            <a th:href="@{/}">Acasă</a> / <span>Coș</span>
        </div>

        <div class="cart-shell">
            <section class="cart-box">
                <h1 style="margin:0 0 .75rem; font-size:1.35rem; font-weight:900;">Coșul tău</h1>

                <div th:if="${cart == null || cart.empty}" style="color:var(--muted);">
                    Coșul este gol. <a th:href="@{/produse}" style="text-decoration:underline;">Vezi produsele</a>
                </div>

                <div th:if="${cart != null && !cart.empty}">
                    <div class="cart-row" th:each="it : ${cart.itemsList}">
                        <a th:href="@{'/produse/' + ${it.slug}}">
                            <img class="cart-img" th:src="${it.imageUrl}" th:alt="${it.title}">
                        </a>

                        <div>
                            <p class="cart-title" th:text="${it.title}">Produs</p>
                            <div class="cart-meta">
                                <span th:text="${it.unitPrice}">0</span> RON / buc ·
                                Total: <span th:text="${it.lineTotal}">0</span> RON
                            </div>
                        </div>

                        <div class="qty">
                            <form th:action="@{/cos/update}" method="post" style="display:flex; gap:.4rem; align-items:center;">
                                <input type="hidden" name="productId" th:value="${it.productId}">
                                <input type="number" name="qty" min="1" th:value="${it.quantity}">
                                <button class="btn-small" type="submit">Update</button>
                            </form>

                            <form th:action="@{/cos/remove}" method="post">
                                <input type="hidden" name="productId" th:value="${it.productId}">
                                <button class="btn-small" type="submit">Șterge</button>
                            </form>
                        </div>
                    </div>

                    <form th:action="@{/cos/clear}" method="post" style="margin-top:.75rem;">
                        <button class="btn-small" type="submit">Golește coșul</button>
                    </form>
                </div>
            </section>

            <aside class="cart-box">
                <h2 style="margin:0 0 .75rem; font-size:1.05rem;">Sumar</h2>

                <div class="sum">
                    <span>Produse</span>
                    <span th:text="${cart != null ? cart.totalQuantity : 0}">0</span>
                </div>

                <div class="sum">
                    <span>Total</span>
                    <span><span th:text="${cart != null ? cart.totalAmount : 0}">0</span> RON</span>
                </div>

                <a class="btn-primary-cart" th:href="@{/checkout}" th:if="${cart != null && !cart.empty}">
                    Continuă către plată
                </a>

                <a class="btn-primary-cart" th:href="@{/produse}" th:if="${cart == null || cart.empty}">
                    Vezi produse
                </a>

                <p style="margin:.75rem 0 0; color:var(--muted); font-size:.9rem;">
                    Următorul pas: facem checkout + livrare + plată.
                </p>
            </aside>
        </div>

    </div>
</main>
<div th:replace="~{public/fragments/layout :: siteFooter}"></div>
<div th:replace="~{public/fragments/layout :: siteScripts}"></div>

<script>
    // Splash (O SINGURĂ DATĂ)
    (function () {
        const splash = document.getElementById("splashScreen");
        const headerLogo = document.querySelector(".logo-img");
        if (!splash) return;

        const isMobile = window.innerWidth <= 640;

        if (!isMobile) {
            splash.classList.add("splash--hidden");
            document.body.classList.remove("has-splash");
            return;
        }

        document.body.classList.add("has-splash");

        const totalSplashTime = 3200;

        setTimeout(() => {
            splash.classList.add("splash--fade-out");

            if (headerLogo) {
                headerLogo.style.opacity = "1";
                headerLogo.style.transform = "translateY(0)";
            }

            setTimeout(() => {
                splash.classList.add("splash--hidden");
                document.body.classList.remove("has-splash");
            }, 600);
        }, totalSplashTime);
    })();

    // Carousel produse noi (O SINGURĂ DATĂ)
    (function () {
        const track = document.getElementById("newProductsTrack");
        if (!track) return;

        const cards = track.querySelectorAll(".new-product-card");
        const prevBtn = document.getElementById("prevNewProducts");
        const nextBtn = document.getElementById("nextNewProducts");
        if (!prevBtn || !nextBtn || cards.length === 0) return;

        const visibleCardsDesktop = 4;
        let index = 0;

        function getVisibleCards() {
            if (window.innerWidth <= 640) return 1;
            if (window.innerWidth <= 900) return 2;
            return visibleCardsDesktop;
        }

        function updateCarousel() {
            const visible = getVisibleCards();
            const maxIndex = Math.max(0, cards.length - visible);
            if (index > maxIndex) index = maxIndex;
            const translatePercent = (100 / visible) * index;
            track.style.transform = `translateX(-${translatePercent}%)`;
        }

        prevBtn.addEventListener("click", () => {
            const visible = getVisibleCards();
            index = Math.max(0, index - visible);
            updateCarousel();
        });

        nextBtn.addEventListener("click", () => {
            const visible = getVisibleCards();
            index = Math.min(cards.length - visible, index + visible);
            updateCarousel();
        });

        window.addEventListener("resize", updateCarousel);
        updateCarousel();
    })();

    // Burger menu (O SINGURĂ DATĂ)
    (function () {
        const burger = document.getElementById("burgerBtn");
        const headerNav = document.querySelector(".header-bottom");
        if (!burger || !headerNav) return;

        burger.addEventListener("click", () => {
            const isOpen = headerNav.classList.toggle("is-open");
            burger.classList.toggle("is-open", isOpen);
            document.body.classList.toggle("nav-open", isOpen);
        });

        window.addEventListener("resize", () => {
            if (window.innerWidth > 640 && headerNav.classList.contains("is-open")) {
                headerNav.classList.remove("is-open");
                burger.classList.remove("is-open");
                document.body.classList.remove("nav-open");
            }
        });
    })();
</script>
</body>
</html>
