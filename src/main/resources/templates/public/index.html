<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ro">
<head>
    <meta charset="UTF-8" />
    <title>Fillermed - Magazin online acid hialuronic</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <link rel="stylesheet" th:href="@{/css/style.css}">
</head>

<body>

<div class="splash-screen" id="splashScreen">
    <div class="splash-doors">
        <div class="splash-door splash-door--left"></div>
        <div class="splash-door splash-door--right"></div>
    </div>
    <div class="splash-inner">
        <img th:src="@{/images/logo1.png}" alt="Fillermed logo" class="splash-logo">
    </div>
</div>

<div th:replace="~{public/fragments/layout :: siteHeader(${cart})}"></div>

<main>
    <section class="hero">
        <div class="hero-inner">
            <div class="hero-overlay"></div>
            <div class="container">
                <div class="hero-content">
                    <div class="hero-left">
                        <form class="search-group" th:action="@{/produse}" method="get">
                            <input type="text" class="search-input" name="q" placeholder="Caută produse" />
                        </form>

                        <p class="hero-subtitle">
                            Magazinul tău online de <span>acid hialuronic</span> și produse profesionale.
                        </p>
                    </div>

                    <div class="hero-button-wrapper">
                        <a class="btn-primary" th:href="@{/produse}">
                            Vezi produse <span class="arrow">→</span>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section class="section">
        <div class="container">
            <h2 class="section-title-center">
                Garanția produselor <span>originale</span> și de <span>cea mai înaltă calitate</span>
            </h2>
        </div>
    </section>

    <section class="section">
        <div class="container promo-section">
            <div class="promo-image">
                <div class="promo-image-inner">
                    <span class="promo-label">La ofertă</span>
                </div>
            </div>
            <div class="promo-right">
                <div>
                    <h2>PROMO</h2>
                    <p>
                        Descoperă oferta lunii. Stoc limitat, preț special și livrare rapidă în toată țara.
                    </p>
                </div>
                <a class="btn-light" th:href="@{/produse}">Cumpără acum!</a>
            </div>
        </div>
    </section>

    <!-- OFERTE (din DB) -->
    <section class="section">
        <div class="container">
            <div class="products-section-header">
                <h2>Produse în ofertă</h2>
                <span style="font-size: 0.85rem; color: var(--muted);"
                      th:text="${#lists.size(offers)} + ' produse'">0 produse</span>
            </div>

            <div class="products-grid">
                <article class="product-card" th:each="p : ${offers}">
                    <a class="product-image" th:href="@{'/produse/' + ${p.slug}}">
                        <img th:src="${p.primaryImage != null ? p.primaryImage.url : '/images/logo1.png'}"
                             th:alt="${p.title}" loading="lazy">
                    </a>

                    <!-- badge categorie (ca pe /produse) -->
                    <div class="product-badge" th:text="${p.category != null ? p.category : 'Produs'}">Produs</div>

                    <h3 class="product-name">
                        <a th:href="@{'/produse/' + ${p.slug}}" th:text="${p.title}">Titlu produs</a>
                    </h3>

                    <!-- preț + preț vechi dacă e reducere -->
                    <div style="margin-top:.1rem;">
          <span class="product-price"
                th:text="${p.discountedPrice != null ? p.discountedPrice : p.price}">0</span>
                        <span style="font-weight:800;"> RON</span>

                        <span class="product-price-old"
                              th:if="${p.discountedPrice != null}"
                              th:text="${p.price + ' RON'}">0 RON</span>
                    </div>

                    <hr class="product-hr" />

                    <!-- descriere scurtă -->
                    <div style="color: var(--muted); font-size:.85rem; line-height:1.35;"
                         th:text="${p.shortDescription != null ? #strings.abbreviate(p.shortDescription, 120) : ''}">
                        Descriere scurtă…
                    </div>

                    <div class="product-actions">
                        <a class="btn-view" th:href="@{'/produse/' + ${p.slug}}">Vezi produsul</a>

                        <!-- adaugă în coș dacă e pe stoc -->
                        <form th:if="${p.stock != null && p.stock > 0}"
                              th:action="@{/cos/add}" method="post" style="flex:1;">
                            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                            <input type="hidden" name="productId" th:value="${p.id}">
                            <input type="hidden" name="qty" value="1">
                            <input type="hidden" name="returnTo" th:value="@{/}">

                            <button class="btn-add-cart" type="submit">Adaugă</button>
                        </form>

                        <!-- stoc epuizat -->
                        <button class="btn-out-of-stock" type="button"
                                th:if="${p.stock == null || p.stock == 0}">
                            Stoc epuizat
                        </button>
                    </div>
                </article>
            </div>
        </div>
    </section>

    <!-- CAROUSEL: PRODUSE NOI (din DB) -->
    <section class="section carousel-section">
        <div class="container">
            <div class="carousel-header">
                <h2>Produse noi</h2>
                <div class="carousel-controls">
                    <button class="carousel-btn" id="prevNewProducts" type="button">←</button>
                    <button class="carousel-btn" id="nextNewProducts" type="button">→</button>
                </div>
            </div>

            <div class="carousel-viewport">
                <div class="new-products-track" id="newProductsTrack">
                    <div class="new-product-card" th:each="p : ${newest}">
                        <div class="new-product-inner">
                            <a class="new-product-image" th:href="@{'/produse/' + ${p.slug}}">
                                <img th:src="${p.primaryImage != null ? p.primaryImage.url : '/images/logo1.png'}"
                                     th:alt="${p.primaryImage != null && p.primaryImage.altText != null ? p.primaryImage.altText : p.title}">
                                <span class="new-product-badge">Produs nou</span>
                            </a>
                            <div class="new-product-title" th:text="${p.title}">Produs</div>
                            <div class="new-product-price">
                                <span th:text="${p.discountedPrice != null ? p.discountedPrice : p.price}">0</span> RON
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </section>
</main>

<div th:replace="~{public/fragments/layout :: siteFooter}"></div>
<div th:replace="~{public/fragments/layout :: siteScripts}"></div>

<div class="whatsapp-float">
    <img th:src="@{/images/wa-button.png}" alt="WhatsApp" class="whatsapp-img">
</div>
<script>
    // Splash (O SINGURĂ DATĂ)
    (function () {
        const splash = document.getElementById("splashScreen");
        const headerLogo = document.querySelector(".logo-img");
        if (!splash) return;

        const isMobile = window.innerWidth <= 640;

        if (!isMobile) {
            splash.classList.add("splash--hidden");
            document.body.classList.remove("has-splash");
            return;
        }

        document.body.classList.add("has-splash");

        const totalSplashTime = 3200;

        setTimeout(() => {
            splash.classList.add("splash--fade-out");

            if (headerLogo) {
                headerLogo.style.opacity = "1";
                headerLogo.style.transform = "translateY(0)";
            }

            setTimeout(() => {
                splash.classList.add("splash--hidden");
                document.body.classList.remove("has-splash");
            }, 600);
        }, totalSplashTime);
    })();

    // Carousel produse noi (O SINGURĂ DATĂ)
    (function () {
        const track = document.getElementById("newProductsTrack");
        if (!track) return;

        const cards = track.querySelectorAll(".new-product-card");
        const prevBtn = document.getElementById("prevNewProducts");
        const nextBtn = document.getElementById("nextNewProducts");
        if (!prevBtn || !nextBtn || cards.length === 0) return;

        const visibleCardsDesktop = 4;
        let index = 0;

        function getVisibleCards() {
            if (window.innerWidth <= 640) return 1;
            if (window.innerWidth <= 900) return 2;
            return visibleCardsDesktop;
        }

        function updateCarousel() {
            const visible = getVisibleCards();
            const maxIndex = Math.max(0, cards.length - visible);
            if (index > maxIndex) index = maxIndex;
            const translatePercent = (100 / visible) * index;
            track.style.transform = `translateX(-${translatePercent}%)`;
        }

        prevBtn.addEventListener("click", () => {
            const visible = getVisibleCards();
            index = Math.max(0, index - visible);
            updateCarousel();
        });

        nextBtn.addEventListener("click", () => {
            const visible = getVisibleCards();
            index = Math.min(cards.length - visible, index + visible);
            updateCarousel();
        });

        window.addEventListener("resize", updateCarousel);
        updateCarousel();
    })();

    // Burger menu (O SINGURĂ DATĂ)
    (function () {
        const burger = document.getElementById("burgerBtn");
        const headerNav = document.querySelector(".header-bottom");
        if (!burger || !headerNav) return;

        burger.addEventListener("click", () => {
            const isOpen = headerNav.classList.toggle("is-open");
            burger.classList.toggle("is-open", isOpen);
            document.body.classList.toggle("nav-open", isOpen);
        });

        window.addEventListener("resize", () => {
            if (window.innerWidth > 640 && headerNav.classList.contains("is-open")) {
                headerNav.classList.remove("is-open");
                burger.classList.remove("is-open");
                document.body.classList.remove("nav-open");
            }
        });
    })();
</script>
</body>
</html>
