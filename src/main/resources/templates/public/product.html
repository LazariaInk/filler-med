<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ro">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title th:text="${product.title + ' | Fillermed'}">Produs | Fillermed</title>
    <meta name="description"
          th:content="${product.shortDescription != null ? #strings.abbreviate(product.shortDescription, 160) : product.title}" />
    <link rel="canonical" th:href="${canonicalUrl}" />
    <meta property="og:type" content="product" />
    <meta property="og:title" th:content="${product.title}" />
    <meta property="og:description"
          th:content="${product.shortDescription != null ? #strings.abbreviate(product.shortDescription, 200) : product.title}" />
    <meta property="og:image"
          th:content="${product.primaryImage != null ? product.primaryImage.url : ''}" />
    <script type="application/ld+json" th:inline="javascript">
        {
            "@context": "https://schema.org",
            "@type": "Product",
            "name": "[[${product.title}]]",
            "image": "[[${product.primaryImage != null ? product.primaryImage.url : ''}]]",
            "description": "[[${product.shortDescription != null ? #strings.abbreviate(product.shortDescription, 300) : product.title}]]",
            "sku": "[[${product.id}]]",
            "brand": {
                "@type": "Brand",
                "name": "[[${product.brand != null ? product.brand : 'Fillermed'}]]"
            },
            "offers": {
                "@type": "Offer",
                "url": "[[${canonicalUrl}]]",
                "priceCurrency": "RON",
                "price": "[[${product.discountedPrice != null ? product.discountedPrice : product.price}]]",
                "availability": "[[${product.stock != null && product.stock > 0 ? 'https://schema.org/InStock' : 'https://schema.org/OutOfStock'}]]",
                "itemCondition": "https://schema.org/NewCondition"
            }
        }
    </script>
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <style>
        .product-page { padding: 1.25rem 0 2rem; }
        .product-shell {
          display: grid;
          grid-template-columns: 1.1fr 0.9fr;
          gap: 1rem;
          align-items: stretch;
        }
        .product-gallery{
  display: flex;
  flex-direction: column;
  height: 100%; /* ca să poată "ține pasul" cu product-info */
}
        .product-main-img{
  width: 100%;
  height: 100%;
  max-height: 100%;
  object-fit: cover;
  background: #f9fafb;

  /* IMPORTANT: scoate aspect-ratio dacă îl ai definit mai sus */
  aspect-ratio: auto;
}

/* 4) thumbnails rămân jos și nu forțează înălțimea imaginii */
.thumbs-wrap{
  margin-top: 0.65rem;
  display: grid;
  grid-template-columns: 38px 1fr 38px;
  gap: 0.5rem;
  align-items: center;
}

.thumbs{
  display: flex;
  gap: 0.4rem;
  overflow-x: auto;
  scroll-behavior: smooth;
  scrollbar-width: none; /* Firefox */
}
.thumbs::-webkit-scrollbar{ display:none; } /* Chrome */

.thumb{
  flex: 0 0 auto;
  width: 64px;
  height: 64px;
  border: 1px solid #e5e7eb;
  background: #fff;
  padding: 0;
  cursor: pointer;
  overflow: hidden;
}
.thumb img{
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.thumb-nav{
  width: 38px;
  height: 38px;
  border: 1px solid #e5e7eb;
  background: #fff;
  font-weight: 900;
  font-size: 20px;
  cursor: pointer;
  display: grid;
  place-items: center;
}
.thumb-nav:hover{ background:#fdf2fb; }

@media (max-width: 900px){
  .thumb{ width: 58px; height: 58px; }
}

        .product-info {
          background: var(--card-bg);
          border: 1px solid #e5e7eb;
          box-shadow: 0 6px 18px rgba(15, 23, 42, 0.08);
          padding: 0.95rem;
        }
        .product-title { margin: 0 0 0.35rem; font-size: 1.35rem; font-weight: 800; }
        .product-meta { display:flex; gap: .6rem; flex-wrap:wrap; font-size:.85rem; color: var(--muted); }
        .product-meta span { background:#f9fafb; border:1px solid #e5e7eb; padding:.25rem .5rem; }
        .price-row { margin-top: .8rem; display:flex; align-items: baseline; gap:.6rem; }
        .price-now { font-size: 1.25rem; font-weight: 900; color: var(--primary); }
        .price-old { color: var(--muted); text-decoration: line-through; }

        .stock { margin-top: .55rem; font-size: .9rem; }
        .stock .ok { color: #16a34a; font-weight: 700; }
        .stock .no { color: #dc2626; font-weight: 700; }

        .cta-row { margin-top: 0.9rem; display:flex; gap:.5rem; flex-wrap: wrap; }
        .btn-buy {
          padding: 0.7rem 1rem;
          border: none;
          background: var(--primary);
          color: #fff;
          font-weight: 700;
          cursor: pointer;
          box-shadow: 0 12px 30px rgba(234, 90, 202, 0.35);
          flex: 1;
          min-width: 180px;
          text-align:center;
        }
        .btn-wa {
          padding: 0.7rem 1rem;
          border: 1px solid #e5e7eb;
          background: #fff;
          font-weight: 700;
          cursor: pointer;
          flex: 1;
          min-width: 180px;
          text-align:center;
        }

        .product-desc {
          margin-top: 1rem;
          background: var(--card-bg);
          border: 1px solid #e5e7eb;
          box-shadow: 0 6px 18px rgba(15, 23, 42, 0.08);
          padding: 0.95rem;
        }
        .product-desc h2 { margin:0 0 .6rem; font-size: 1.05rem; }
        .desc-html :is(p, ul, ol) { margin: 0 0 0.7rem; }
        .desc-html ul { padding-left: 1.1rem; }

        @media (max-width: 900px){
          .product-shell { grid-template-columns: 1fr; }
          .thumbs { grid-template-columns: repeat(5, minmax(0, 1fr)); }
        }
        .product-main-img{ min-height: 360px; }

        @media (max-width: 640px) {
  .logo-img {
    opacity: 1;
    transform: translateY(0);
    transition: opacity 0.5s ease, transform 0.5s ease;
  }

  /* ascundem doar când splash-ul e activ */
  body.has-splash .logo-img {
    opacity: 0;
    transform: translateY(-10px);
  }
}
    </style>
</head>
<body>
<div th:replace="~{public/fragments/layout :: siteHeader(${cart})}"></div>
<main class="product-page">
    <div class="container">
        <div style="font-size:.85rem; color: var(--muted); margin: .25rem 0 1rem;">
            <a th:href="@{/}">Acasă</a> / <a th:href="@{/produse}">Produse</a> /
            <span th:text="${product.title}">Produs</span>
        </div>
        <div class="product-shell">
            <section class="product-gallery">
                <img id="mainProductImg"
                     class="product-main-img"
                     th:src="${product.primaryImage != null ? product.primaryImage.url : '/images/logo1.png'}"
                     th:alt="${product.primaryImage != null && product.primaryImage.altText != null ? product.primaryImage.altText : product.title}" />

                <div class="thumbs-wrap" th:if="${product.images != null and !#lists.isEmpty(product.images)}">
                    <button type="button" class="thumb-nav prev" onclick="scrollThumbs(-1)" aria-label="Înapoi">‹</button>

                    <div class="thumbs" id="thumbsTrack">
                        <button type="button"
                                class="thumb"
                                th:each="img : ${product.images}"
                                th:attr="data-src=${img.url}, data-alt=${img.altText != null ? img.altText : product.title}"
                                onclick="swapImg(this)">
                            <img th:src="${img.url}"
                                 th:alt="${img.altText != null ? img.altText : product.title}">
                        </button>
                    </div>

                    <button type="button" class="thumb-nav next" onclick="scrollThumbs(1)" aria-label="Înainte">›</button>
                </div>
            </section>
            <aside class="product-info">
                <h1 class="product-title" th:text="${product.title}">Titlu produs</h1>

                <div class="product-meta">
                    <span th:if="${product.brand != null}" th:text="${'Brand: ' + product.brand}">Brand</span>
                    <span th:if="${product.category != null}" th:text="${'Categorie: ' + product.category}">Categorie</span>
                    <span th:if="${product.volume != null}" th:text="${'Volum: ' + product.volume}">Volum</span>
                    <span th:if="${product.indication != null}" th:text="${'Indicații: ' + product.indication}">Indicații</span>
                </div>

                <div class="price-row">
                    <div class="price-now">
                        <span th:text="${product.discountedPrice != null ? product.discountedPrice : product.price}">0</span> RON
                    </div>
                    <div class="price-old" th:if="${product.discountedPrice != null}">
                        <span th:text="${product.price}">0</span> RON
                    </div>
                </div>

                <div class="stock">
                    <span th:if="${product.stock != null and product.stock > 0}" class="ok">În stoc</span>
                    <span th:if="${product.stock != null and product.stock == 0}" class="no">Stoc epuizat</span>
                </div>

                <p style="margin:.75rem 0 0; color: var(--muted); font-size:.95rem;"
                   th:text="${product.shortDescription}">
                    Descriere scurtă produs.
                </p>

                <div class="cta-row">
                    <form th:action="@{/cos/add}" method="post" style="flex:1; min-width:180px;">
                        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                        <input type="hidden" name="productId" th:value="${product.id}" />
                        <input type="hidden" name="returnTo" th:value="${canonicalUrl}" />

                        <div style="display:flex; gap:.5rem;">
                            <input type="number" name="qty" min="1"
                                   th:attr="max=${product.stock != null ? product.stock : 0}"
                                   value="1"
                                   style="width:80px; padding:.7rem .8rem; border:1px solid #e5e7eb;" />

                            <button class="btn-buy" type="submit"
                                    th:disabled="${product.stock == null || product.stock == 0}">
                                Adaugă în coș
                            </button>
                        </div>
                    </form>
                </div>
            </aside>
        </div>
        <section class="product-desc" th:if="${product.description != null}">
            <h2>Descriere</h2>
            <div class="desc-html" th:utext="${product.description}"></div>
        </section>
    </div>
</main>
<div th:replace="~{public/fragments/layout :: siteFooter}"></div>
<div th:replace="~{public/fragments/layout :: siteScripts}"></div>

<div class="whatsapp-float">
    <img th:src="@{/images/wa-button.png}" alt="WhatsApp" class="whatsapp-img">
</div>

<script>
    function swapImg(btn){
      const img = document.getElementById("mainProductImg");
      const src = btn.getAttribute("data-src");
      const alt = btn.getAttribute("data-alt") || "";
      if (img && src){
        img.src = src;
        img.alt = alt;
      }
    }

    // burger (ca pe home)
    (function () {
      const burger = document.getElementById("burgerBtn");
      const headerNav = document.querySelector(".header-bottom");
      if (!burger || !headerNav) return;

      burger.addEventListener("click", () => {
        const isOpen = headerNav.classList.toggle("is-open");
        burger.classList.toggle("is-open", isOpen);
        document.body.classList.toggle("nav-open", isOpen);
      });

      window.addEventListener("resize", () => {
        if (window.innerWidth > 640 && headerNav.classList.contains("is-open")) {
          headerNav.classList.remove("is-open");
          burger.classList.remove("is-open");
          document.body.classList.remove("nav-open");
        }
      });
    })();
</script>
<script>
    function swapImg(btn){
      const img = document.getElementById("mainProductImg");
      const src = btn.getAttribute("data-src");
      const alt = btn.getAttribute("data-alt") || "";
      if (img && src){
        img.src = src;
        img.alt = alt;
      }
    }

    function scrollThumbs(dir){
      const track = document.getElementById("thumbsTrack");
      if (!track) return;

      const firstThumb = track.querySelector(".thumb");
      const step = firstThumb ? (firstThumb.offsetWidth + 8) * 3 : 220; // 3 thumb-uri
      track.scrollBy({ left: dir * step, behavior: "smooth" });
    }
</script>
</body>
</html>
