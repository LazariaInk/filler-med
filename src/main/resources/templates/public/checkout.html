<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ro">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title>Checkout | Fillermed</title>
    <link rel="stylesheet" th:href="@{/css/style.css}">

    <style>
        .checkout-page{ padding: 1.25rem 0 2rem; }
        .checkout-shell{
          display:grid;
          grid-template-columns: 1fr 0.38fr;
          gap: 1rem;
          align-items:start;
        }
        .card{
          background: var(--card-bg);
          border: 1px solid #e5e7eb;
          box-shadow: 0 6px 18px rgba(15,23,42,.08);
          padding: 1rem;
        }
        .card h1{ margin:0 0 .75rem; font-size:1.35rem; font-weight:900; }
        .card h2{ margin:0 0 .75rem; font-size:1.05rem; font-weight:900; }

        .field-grid{
          display:grid;
          grid-template-columns: 1fr 1fr;
          gap: .8rem;
        }
        .field{ display:flex; flex-direction:column; gap:.35rem; }
        .field label{ font-weight:800; font-size:.9rem; }
        .field input, .field textarea, .field select{
          width:100%;
          padding:.7rem .85rem;
          border:1px solid #d1d5db;
          background:#fff;
          outline:none;
          font-size:.95rem;
        }
        .field input:focus, .field textarea:focus, .field select:focus{
          border-color: var(--primary);
          box-shadow: 0 0 0 1px rgba(234,90,202,.25);
        }
        .field textarea{ min-height: 110px; resize: vertical; }

        .pay-choice{
          display:flex;
          flex-direction:column;
          gap:.6rem;
          margin-top:.2rem;
        }
        .radio-row{
          display:flex;
          gap:.6rem;
          align-items:flex-start;
          padding:.7rem .8rem;
          border:1px solid #e5e7eb;
          background: linear-gradient(180deg, #ffffff, #f9fafb);
          cursor:pointer;
        }
        .radio-row:hover{ background:#fdf2fb; }
        .radio-row input{ margin-top:.2rem; }
        .radio-title{ font-weight:900; }
        .radio-sub{ color: var(--muted); font-size:.9rem; margin-top:.1rem; }

        .sum{
          display:flex;
          justify-content:space-between;
          margin:.45rem 0;
          font-weight:800;
        }
        .btn-primary-cart{
          width:100%;
          padding:.85rem 1rem;
          border:none;
          background: var(--primary);
          color:#fff;
          font-weight:900;
          cursor:pointer;
          box-shadow: 0 12px 30px rgba(234,90,202,.25);
          text-align:center;
          display:block;
        }
        .btn-primary-cart:hover{
          background: var(--primary-dark);
        }

        .note{
          margin:.75rem 0 0;
          color: var(--muted);
          font-size:.9rem;
          line-height:1.5;
        }

        @media (max-width: 900px){
          .checkout-shell{ grid-template-columns: 1fr; }
          .field-grid{ grid-template-columns: 1fr; }
        }
        @media (max-width: 640px) {
  .logo-img {
    opacity: 1;
    transform: translateY(0);
    transition: opacity 0.5s ease, transform 0.5s ease;
  }

  /* ascundem doar când splash-ul e activ */
  body.has-splash .logo-img {
    opacity: 0;
    transform: translateY(-10px);
  }
}
    </style>
</head>
<body>

<div th:replace="~{public/fragments/layout :: siteHeader(${cart})}"></div>

<main class="checkout-page">
    <div class="container">

        <div style="font-size:.85rem; color: var(--muted); margin: .25rem 0 1rem;">
            <a th:href="@{/}">Acasă</a> / <a th:href="@{/cos}">Coș</a> / <span>Checkout</span>
        </div>

        <div class="checkout-shell">
            <section class="card">
                <h1>Finalizare comandă</h1>

                <form th:action="@{/checkout/place}" method="post">
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>

                    <div class="field-grid">
                        <div class="field">
                            <label for="customerName">Nume</label>
                            <input id="customerName" name="customerName" required/>
                        </div>

                        <div class="field">
                            <label for="customerPhone">Telefon</label>
                            <input id="customerPhone" name="customerPhone" required/>
                        </div>

                        <div class="field">
                            <label for="customerEmail">Email</label>
                            <input id="customerEmail" name="customerEmail" type="email" required/>
                        </div>

                        <div class="field">
                            <label for="paymentMethod">Metodă de plată</label>

                            <!-- păstrăm select-ul ca fallback; radio e mai “shop-like” -->
                            <select id="paymentMethod" name="paymentMethod" style="display:none;">
                                <option value="COD">COD</option>
                                <option value="STRIPE">STRIPE</option>
                            </select>

                            <div class="pay-choice">
                                <label class="radio-row" onclick="document.getElementById('pm_cod').checked=true; syncPm();">
                                    <input id="pm_cod" type="radio" name="pmRadio" value="COD" checked>
                                    <div>
                                        <div class="radio-title">Cash la livrare (COD)</div>
                                        <div class="radio-sub">Plătești curierului când ajunge coletul.</div>
                                    </div>
                                </label>

                                <label class="radio-row" onclick="document.getElementById('pm_stripe').checked=true; syncPm();">
                                    <input id="pm_stripe" type="radio" name="pmRadio" value="STRIPE">
                                    <div>
                                        <div class="radio-title">Card (Stripe)</div>
                                        <div class="radio-sub">Plată securizată cu cardul, confirmare instant.</div>
                                    </div>
                                </label>
                            </div>
                        </div>
                    </div>

                    <div class="field" style="margin-top:.8rem;">
                        <label for="shippingAddress">Adresă livrare</label>
                        <textarea id="shippingAddress" name="shippingAddress" required></textarea>
                    </div>

                    <div style="margin-top:1rem; display:flex; gap:.6rem; flex-wrap:wrap;">
                        <a class="btn-view" th:href="@{/cos}" style="min-width:200px; text-align:center;">Înapoi la coș</a>
                        <button class="btn-primary-cart" type="submit" style="flex:1; min-width:220px;">
                            Plasează comanda
                        </button>
                    </div>

                    <p class="note">
                        După plasare: dacă alegi <b>Card</b> vei fi direcționat către plata securizată.
                        Dacă alegi <b>COD</b>, comanda intră direct în procesare.
                    </p>
                </form>
            </section>

            <aside class="card">
                <h2>Sumar</h2>

                <div class="sum">
                    <span>Produse</span>
                    <span th:text="${cart != null ? cart.totalQuantity : 0}">0</span>
                </div>

                <div class="sum">
                    <span>Total</span>
                    <span><span th:text="${cart != null ? cart.totalAmount : 0}">0</span> RON</span>
                </div>

                <p class="note">
                    În admin vei vedea statusul comenzii și dacă este <b>PLĂTITĂ</b> (Stripe) sau <b>COD</b>.
                </p>
            </aside>
        </div>

    </div>
</main>

<div th:replace="~{public/fragments/layout :: siteFooter}"></div>
<div th:replace="~{public/fragments/layout :: siteScripts}"></div>

<script>
    function syncPm(){
      const select = document.getElementById("paymentMethod");
      const cod = document.getElementById("pm_cod").checked;
      select.value = cod ? "COD" : "STRIPE";
    }
    syncPm();
</script>
<script>
    // Splash (O SINGURĂ DATĂ)
    (function () {
        const splash = document.getElementById("splashScreen");
        const headerLogo = document.querySelector(".logo-img");
        if (!splash) return;

        const isMobile = window.innerWidth <= 640;

        if (!isMobile) {
            splash.classList.add("splash--hidden");
            document.body.classList.remove("has-splash");
            return;
        }

        document.body.classList.add("has-splash");

        const totalSplashTime = 3200;

        setTimeout(() => {
            splash.classList.add("splash--fade-out");

            if (headerLogo) {
                headerLogo.style.opacity = "1";
                headerLogo.style.transform = "translateY(0)";
            }

            setTimeout(() => {
                splash.classList.add("splash--hidden");
                document.body.classList.remove("has-splash");
            }, 600);
        }, totalSplashTime);
    })();

    // Carousel produse noi (O SINGURĂ DATĂ)
    (function () {
        const track = document.getElementById("newProductsTrack");
        if (!track) return;

        const cards = track.querySelectorAll(".new-product-card");
        const prevBtn = document.getElementById("prevNewProducts");
        const nextBtn = document.getElementById("nextNewProducts");
        if (!prevBtn || !nextBtn || cards.length === 0) return;

        const visibleCardsDesktop = 4;
        let index = 0;

        function getVisibleCards() {
            if (window.innerWidth <= 640) return 1;
            if (window.innerWidth <= 900) return 2;
            return visibleCardsDesktop;
        }

        function updateCarousel() {
            const visible = getVisibleCards();
            const maxIndex = Math.max(0, cards.length - visible);
            if (index > maxIndex) index = maxIndex;
            const translatePercent = (100 / visible) * index;
            track.style.transform = `translateX(-${translatePercent}%)`;
        }

        prevBtn.addEventListener("click", () => {
            const visible = getVisibleCards();
            index = Math.max(0, index - visible);
            updateCarousel();
        });

        nextBtn.addEventListener("click", () => {
            const visible = getVisibleCards();
            index = Math.min(cards.length - visible, index + visible);
            updateCarousel();
        });

        window.addEventListener("resize", updateCarousel);
        updateCarousel();
    })();

    // Burger menu (O SINGURĂ DATĂ)
    (function () {
        const burger = document.getElementById("burgerBtn");
        const headerNav = document.querySelector(".header-bottom");
        if (!burger || !headerNav) return;

        burger.addEventListener("click", () => {
            const isOpen = headerNav.classList.toggle("is-open");
            burger.classList.toggle("is-open", isOpen);
            document.body.classList.toggle("nav-open", isOpen);
        });

        window.addEventListener("resize", () => {
            if (window.innerWidth > 640 && headerNav.classList.contains("is-open")) {
                headerNav.classList.remove("is-open");
                burger.classList.remove("is-open");
                document.body.classList.remove("nav-open");
            }
        });
    })();
</script>

</body>
</html>
